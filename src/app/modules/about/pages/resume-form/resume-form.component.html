<div class="flex flex-col min-h-screen mt-3">
  <mat-stepper class="w-full" [linear]="true" #stepper>
    <!-- Work experience step (restored) -->
    <mat-step [stepControl]="experienceFormGroup" [editable]="true">
      <ng-template matStepLabel>Work experience</ng-template>

      <form [formGroup]="experienceFormGroup">
        <div class="mb-4">
          <button
            mat-raised-button
            color="primary"
            type="button"
            (click)="addExperience()"
          >
            Add experience
          </button>
          <div class="flex justify-end mt-4">
            <button mat-button matStepperNext>Next</button>
          </div>
          <div
            *ngFor="let exp of experiences.controls; let i = index"
            class="mb-4"
          >
            <app-work-experience [group]="exp"></app-work-experience>
            <div class="mt-2">
              <button
                mat-button
                color="warn"
                type="button"
                (click)="removeExperience(i)"
              >
                Remove
              </button>
            </div>
          </div>
        </div>
      </form>

      <div>
        <button mat-button matStepperNext>Next</button>
      </div>
    </mat-step>

    <!-- Technologies step -->
    <mat-step [stepControl]="technologiesFormGroup">
      <ng-template matStepLabel>Technologies</ng-template>
      <form [formGroup]="technologiesFormGroup">
        <div formArrayName="technologies">
          <div
            *ngFor="let t of technologies.controls; let i = index"
            class="mb-2 flex items-center"
          >
            <mat-form-field class="flex-1 mr-2" appearance="fill">
              <mat-label>Technology</mat-label>
              <input matInput [formControlName]="i" placeholder="Angular" />
            </mat-form-field>
            <button
              mat-icon-button
              color="warn"
              type="button"
              (click)="removeTechnology(i)"
            >
              <mat-icon>remove_circle</mat-icon>
            </button>
          </div>
          <div class="mb-4">
            <button mat-button type="button" (click)="addTechnology()">
              Add technology
            </button>
          </div>
        </div>
        <div class="flex justify-between mt-4">
          <div></div>
          <button
            mat-button
            matStepperNext
            [disabled]="technologiesFormGroup.invalid"
          >
            Next
          </button>
        </div>
      </form>
    </mat-step>

    <!-- Education step (list) -->
    <mat-step [stepControl]="educationFormGroup">
      <ng-template matStepLabel>Education</ng-template>
      <form [formGroup]="educationFormGroup">
        <div class="mb-4">
          <button
            mat-raised-button
            color="primary"
            type="button"
            (click)="addEducation()"
          >
            Add education
          </button>
        </div>

        <div formArrayName="educations">
          <div
            *ngFor="let edu of educations.controls; let i = index"
            [formGroupName]="i"
            class="mb-4 border p-4 rounded"
          >
            <div class="flex justify-between items-center mb-2">
              <h3 class="font-semibold">Education {{ i + 1 }}</h3>
              <button
                mat-icon-button
                color="warn"
                type="button"
                (click)="removeEducation(i)"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </div>

            <div>
              <mat-form-field appearance="fill" class="w-full">
                <mat-label>Name</mat-label>
                <input
                  matInput
                  formControlName="name"
                  placeholder="Degree or Course"
                />
              </mat-form-field>

              <div formGroupName="institution">
                <mat-form-field appearance="fill" class="w-full">
                  <mat-label>Institution</mat-label>
                  <input
                    matInput
                    formControlName="name"
                    placeholder="Institution"
                  />
                </mat-form-field>
                <div formGroupName="location" class="grid grid-cols-2 gap-2">
                  <mat-form-field appearance="fill">
                    <mat-label>City</mat-label>
                    <input matInput formControlName="city" placeholder="City" />
                  </mat-form-field>
                  <mat-form-field appearance="fill">
                    <mat-label>Country</mat-label>
                    <input
                      matInput
                      formControlName="country"
                      placeholder="Country"
                    />
                  </mat-form-field>
                </div>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <mat-form-field appearance="fill" class="w-full">
                  <mat-label>Begin At</mat-label>
                  <input
                    matInput
                    formControlName="beginAt"
                    placeholder="YYYY"
                  />
                </mat-form-field>
                <mat-form-field appearance="fill" class="w-full">
                  <mat-label>End At</mat-label>
                  <input
                    matInput
                    formControlName="endAt"
                    placeholder="YYYY or Present"
                  />
                </mat-form-field>
              </div>

              <mat-form-field appearance="fill" class="w-full">
                <mat-label>Description</mat-label>
                <textarea
                  matInput
                  formControlName="description"
                  rows="3"
                  placeholder="Details"
                ></textarea>
              </mat-form-field>
            </div>
          </div>
        </div>

        <div class="flex justify-between mt-4">
          <button mat-button matStepperPrevious>Back</button>
          <button
            mat-button
            matStepperNext
            [disabled]="educationFormGroup.invalid"
          >
            Next
          </button>
        </div>
      </form>
    </mat-step>

    <!-- Projects step (list) -->
    <mat-step [stepControl]="projectsFormGroup">
      <ng-template matStepLabel>Projects</ng-template>
      <form [formGroup]="projectsFormGroup">
        <div formArrayName="projects">
          <div
            *ngFor="let p of projects.controls; let i = index"
            class="mb-4 flex items-start"
          >
            <mat-form-field class="flex-1 mr-2" appearance="fill">
              <mat-label>Project</mat-label>
              <input
                matInput
                [formControlName]="i"
                placeholder="Project Awesome"
              />
            </mat-form-field>
            <button
              mat-icon-button
              color="warn"
              type="button"
              (click)="removeProject(i)"
            >
              <mat-icon>remove_circle</mat-icon>
            </button>
          </div>
          <div class="mb-4">
            <button mat-button type="button" (click)="addProject()">
              Add project
            </button>
          </div>
        </div>
        <div class="flex justify-between mt-4">
          <button mat-button matStepperPrevious>Back</button>
          <button
            mat-button
            matStepperNext
            [disabled]="projectsFormGroup.invalid"
          >
            Next
          </button>
        </div>
      </form>
    </mat-step>

    <!-- Interests step (list) -->
    <mat-step [stepControl]="interestFormGroup">
      <ng-template matStepLabel>Interests</ng-template>
      <form [formGroup]="interestFormGroup">
        <div formArrayName="interests">
          <div
            *ngFor="let it of interests.controls; let i = index"
            class="mb-2 flex items-center"
          >
            <mat-form-field class="flex-1 mr-2" appearance="fill">
              <mat-label>Interest</mat-label>
              <input matInput [formControlName]="i" placeholder="Open-source" />
            </mat-form-field>
            <button
              mat-icon-button
              color="warn"
              type="button"
              (click)="removeInterest(i)"
            >
              <mat-icon>remove_circle</mat-icon>
            </button>
          </div>
          <div class="mb-4">
            <button mat-button type="button" (click)="addInterest()">
              Add interest
            </button>
          </div>
        </div>
        <div class="flex justify-between mt-4">
          <button mat-button matStepperPrevious>Back</button>
          <button
            mat-button
            color="primary"
            (click)="onSubmit()"
            [disabled]="interestFormGroup.invalid"
          >
            Finish
          </button>
        </div>
      </form>
    </mat-step>

    <!-- Done step -->
    <mat-step>
      <ng-template matStepLabel>Done</ng-template>
      <p>Your resume section is ready.</p>
      <div class="flex justify-between mt-4">
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button (click)="stepper.reset()">Reset</button>
      </div>
    </mat-step>
  </mat-stepper>
</div>
